# GA-Bind：多配体同时对接的可微最优分配机制

## 1. 问题设定
现有对接方法几乎全部假设 **单配体独立结合**，即每次只预测一个配体在蛋白口袋的结合姿势。  
但在真实场景中，一个蛋白口袋往往能容纳多个配体或片段，且它们之间存在 **协同** 或 **竞争** 作用。  

因此，需要解决的核心问题是：  
> **如何在一次推理中，同时生成 N 个配体的无冲突可行对接姿势，并保持整体能量/几何的合理性？**

---

## 2. 动机与现有方法的不足
### 2.1 现有方法
- **FlowDock (2024)**：可建模 apo→holo，但仍以单配体为单位，冲突依赖事后筛除。  
- **DynamicBind (2024)**：考虑柔性口袋，但依旧单配体生成，缺乏 ligand–ligand 占位关系。  
- **GroupBind (ICLR 2025)**：提出多配体信息共享，但**每个配体依旧独立生成**，之后用贪心/打分筛选，不能保证全局最优、无冲突分配。  

### 2.2 动机
现有方法的共同问题：
1. **缺少分配机制**：姿势只能靠后处理筛选，易冲突、效率低。  
2. **贪心/打分局限**：配体顺序敏感，难以保证全局最优。  
3. **缺乏可微算子**：分配不是计算图的一部分，无法端到端学习“避免冲突”。  

---

## 3. GA-Bind 的关键创新
1. **内隐可微分配层**  
   - 提出 **GA-Ligand 分配层**：结合 **Gromov–Wasserstein (GW) 最优传输** 与 **可微拍卖算法**，实现 **N 配体 → N 个亚位点** 的全局最优匹配。  
   - 该分配层直接嵌入网络前向，保证输出姿势天然无冲突。  

2. **冲突避免的硬约束**  
   - 冲突检测通过 **SDF 投影 / vdW 半径裁剪** 实现，不再依赖 soft-loss。  
   - 推理时只需一次投影即可裁剪非法姿势，减少采样震荡。  

3. **与现有方法的差异**  
   - **非独立生成**：不同于 GroupBind 的“信息共享但独立生成”，GA-Bind 在推理中直接整体优化。  
   - **机制优于损失**：通过前向分配算子完成约束 → 不需要额外损失堆叠。  
   - **端到端可微**：GW-OT + 拍卖近似是可微的，训练时即可学习避免冲突。  
   - **全局最优分配**：通过 OT 保证所有配体的占位是整体最优，而不是依赖顺序或贪心。  

---

## 4. 公式描述

### 4.1 输入与目标
- 受体口袋建模为图  
  \[
  G^{\mathrm{poc}}=(V,E),\quad |V|=K
  \]  
  其中 \(V\) 表示候选亚位点。  

- 第 \(i\) 个配体的候选姿势记为 \(x_i\)，总共有 \(N\) 个配体。  

目标：求解联合分配矩阵 \(\Gamma \in \mathbb{R}_{\ge0}^{N\times K}\)，使得配体–位点分配整体代价最小，且输出姿势合法无冲突。

### 4.2 分配约束
\[
\mathcal{U} = \Big\{\Gamma \ge 0 \;\big|\; \Gamma \mathbf{1}_K = \tfrac{1}{N}\mathbf{1}_N,\; \Gamma^\top \mathbf{1}_N \le \tfrac{1}{N}\mathbf{1}_K \Big\}.
\]

### 4.3 融合几何与化学的代价
- 配体间几何矩阵：\(D^{\mathrm{lig}} \in \mathbb{R}^{N\times N}\)。  
- 位点间几何矩阵：\(D^{\mathrm{poc}} \in \mathbb{R}^{K\times K}\)。  
- 化学特征：\(F^{\mathrm{lig}}, F^{\mathrm{poc}}\)，定义单点代价  
  \[
  c_{\mathrm{chem}}(f_i,g_k) \ge 0.
  \]

**融合 GW 目标**：
\[
\boxed{
\min_{\Gamma \in \mathcal{U}}
\sum_{i,j,k,\ell}
\big| D^{\mathrm{lig}}_{ij} - D^{\mathrm{poc}}_{k\ell} \big|^2 \,\Gamma_{ik}\Gamma_{j\ell}
+ \lambda \sum_{i,k} c_{\mathrm{chem}}(f_i,g_k)\,\Gamma_{ik}
+ \varepsilon H(\Gamma)
}
\]

其中 \(H(\Gamma)=-\sum_{i,k}\Gamma_{ik}\log\Gamma_{ik}\) 是熵正则。

### 4.4 冲突约束
投影操作：若任意两个配体 \(p_i, p_j\) 在生成坐标下满足  
\[
\|p_i - p_j\| < 0.6 \times (r_i^{\text{vdW}} + r_j^{\text{vdW}})
\]  
则强制裁剪/重采样，确保无穿插。

---

## 5. 理论结果

### 定理 1 （收缩性与收敛）
若代价函数在局部满足 \(\mu\)-强凸条件，则熵正则 GW 问题的 Sinkhorn–拍卖迭代是 \(\kappa\)-收缩映射，且在有限步内收敛到 \(\varepsilon\)-近优分配：
\[
\|\Gamma^{(t+1)} - \Gamma^*\|_F \le \kappa \|\Gamma^{(t)} - \Gamma^*\|_F,\quad 0<\kappa<1.
\]

### 定理 2 （冲突率上界）
设口袋 SDF 满足下界 \(\delta>0\)，则投影后的联合姿势冲突率满足：
\[
\Pr[\text{Overlap}] \le C(\delta)\cdot \varepsilon,
\]
其中 \(\varepsilon\) 为分配近似误差，\(C(\delta)\) 与口袋几何下界相关。  
→ 说明：随着投影与分配精度提升，冲突率单调下降。

### 推论（与现有方法对比）
- GroupBind：缺乏机制层，冲突率仅依赖后处理 → 无法给出理论保证。  
- GA-Bind：由收缩性与冲突率上界保证**生成后姿势合法率单调提升**。

---

## 6. 审稿视角亮点
1. **机制性创新**：将 OT-拍卖作为内隐可微算子嵌入 docking pipeline。  
2. **理论支撑**：给出分配收敛性与冲突率上界的证明 sketch，保证方法稳定性。  
3. **区别于前作**：不是简单“加损失”或“后处理”，而是一个**可插拔、可微、具备理论保证**的分配层。
