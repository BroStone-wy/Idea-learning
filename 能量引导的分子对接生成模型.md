## 基于扩散/DiT模型的能量引导的分子对接算法
- 问题本质：把分子对接后的构象视为数据分布，利用生成模型学习数据几何分布流形，全原子或者低维流形（刚性运动+柔性运动的流行空间）；要考虑几何合理的同时，也要保证能量合理（学习物理合理性）。
  - 几何合理性：深度模型预测或者生成的构象和真实构象在rmsd度量下差异较小；
  - 物理合理性：不同对接点之间受到实际化学键约束，反映在局部对接距离上有长有短；
  - 忽略物理合理性：就会导致整体看起来对接几何位置像，局部实际不合理；主要就是平均对接的rmsd小，不代表局部对接要求的物理合理性；

## 出发点：对接几何位置正确的同时，能量/物理也合理。
- 现有做法：
   - 亲和力预测和分子对接的多任务优化：两任务共享编码器，接不同的任务头协同学习，通过亲和力任务学的信息通过共享编码器间接影响分子对接任务的性能；两个任务侧重优化点分别是物理（结合能量角度）和几何。所以对于编码器特征优化的角度和侧重点不同（可能优化方向不一致），协同的能力有限。
   - 能量正则的分子对接模型：先生成几何合理的构象（rmsd小），再基于预定义好的能量函数矫正。不同模型能量正则的时间不一样，有些是在生成过程中（去噪优化方向加正则项），有些是在生成之后，再基于能量最优的方式去筛选。
   生成过程中正则，相当于优化方向做加法，需要balance物理和几何优化方向，才能实现两者兼顾而不是陷入局部最优，所以两者耦合一般。生成后做正则，相当于对接任务做多阶段加法，先生成再筛选，一个模型的事拆分成多个模型先后配合，流程复杂。
- 目的：基于DiT模型学习一个物理和几何的联合分布，在生成过程中，每一步迭代的对接构象同时满足物理和几何合理，而不是一先一后，真正做到自适应地平衡几何正确性与能量稳定性。

## 解决方式：
- 主要借鉴LaVin-DiT视觉模型的做法，其考虑建立联合潜空间表示学习一个联合梯度场，该篇论文使得多任务可以用一个去噪生成过程优化，并且通过in-context learning自动实现视觉多任务自动调整训练，做到多任务通用模型。
- 希望模型做到两个点：能量和几何联合生成优化。任务方面，亲和力预测任务或者分子对接任务一个模型都可以做。

## 相关知识储备
- 条件扩散模型的训练，包括DiT模型的训练；
- 搞清楚diffdock，flowdock，CFMdock，DiTmol关于分子对接任务的代码实现；核心baseline Lavin-DiT模型的论文学习以及代码实现；
- 将分子对接以及亲和力任务的token怎么模仿的嵌入到Lavin-DiT架构中，设计好怎么训练。
